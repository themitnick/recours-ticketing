import{b as F,d as P,i as z}from"./chunk-56AGBO7K.js";import{f as B,g as q}from"./chunk-PV6U5WT5.js";import{a as te}from"./chunk-GGN3SA2B.js";import{$b as W,Aa as A,Da as v,Na as N,Ob as M,Pb as D,Qb as U,Sb as L,Ta as m,Ua as n,Ub as j,V as u,Va as i,Vb as O,W as p,Wa as x,X as g,Y as h,_a as f,ab as _,ac as G,c as V,cb as l,dc as J,fc as H,gc as $,hc as Q,ic as K,kb as a,kc as X,lb as C,lc as Y,mb as E,mc as Z,nb as I,nc as ee,ob as T,pb as S,qa as c,qb as b,ua as R,ub as w,vb as y,wb as k}from"./chunk-I6GMZB6S.js";function ne(o,t){o&1&&(n(0,"span",75),g(),n(1,"svg",76),x(2,"path",67),i(),a(3," Validation N1 "),i())}function re(o,t){o&1&&(n(0,"span",77),g(),n(1,"svg",76),x(2,"path",67),i(),a(3," Validation N2 "),i())}function ae(o,t){o&1&&(n(0,"span",78),g(),n(1,"svg",76),x(2,"path",79),i(),a(3," R\xE9assignation "),i())}function oe(o,t){o&1&&(n(0,"span",80),g(),n(1,"svg",76),x(2,"path",63),i(),a(3," Fermeture "),i())}function se(o,t){if(o&1&&(n(0,"div",68)(1,"span",69),a(2),i(),n(3,"div",70),v(4,ne,4,0,"span",71)(5,re,4,0,"span",72)(6,ae,4,0,"span",73)(7,oe,4,0,"span",74),i()()),o&2){let e=l(2);c(),m("ngClass",e.getRoleBadgeClass(e.currentUser.role)),c(),E(" ",e.getRoleLabel(e.currentUser.role)," "),c(2),m("ngIf",e.canValidateNiveau1),c(),m("ngIf",e.canValidateNiveau2),c(),m("ngIf",e.canAssignToOthers),c(),m("ngIf",e.canCloseRecours)}}function ce(o,t){if(o&1&&(n(0,"option",81),a(1),i()),o&2){let e=t.$implicit;m("value",e.email),c(),C(e.nom)}}function le(o,t){if(o&1){let e=f();n(0,"div",82)(1,"label",20),a(2,"Montant contest\xE9 (FCFA)"),i(),n(3,"input",83),b("ngModelChange",function(r){u(e);let d=l(2);return S(d.item.montantConteste,r)||(d.item.montantConteste=r),p(r)}),i()()}if(o&2){let e=l(2);c(3),T("ngModel",e.item.montantConteste)}}function me(o,t){if(o&1){let e=f();n(0,"div",40)(1,"div")(2,"label",20),a(3,"Commentaire de validation (optionnel)"),i(),n(4,"textarea",101),b("ngModelChange",function(r){u(e);let d=l(4);return S(d.commentaireValidation1,r)||(d.commentaireValidation1=r),p(r)}),i()(),n(5,"div",11)(6,"button",102),_("click",function(){u(e);let r=l(4);return p(r.confirmerDecision())}),a(7," Confirmer la validation "),i(),n(8,"button",12),_("click",function(){u(e);let r=l(4);return p(r.annulerDecision())}),a(9," Annuler "),i()()()}if(o&2){let e=l(4);c(4),T("ngModel",e.commentaireValidation1)}}function de(o,t){if(o&1){let e=f();n(0,"div",40)(1,"div")(2,"label",20),a(3,"Motif du rejet "),n(4,"span",103),a(5,"*"),i()(),n(6,"textarea",104),b("ngModelChange",function(r){u(e);let d=l(4);return S(d.explicationRejet,r)||(d.explicationRejet=r),p(r)}),i()(),n(7,"div",11)(8,"button",105),_("click",function(){u(e);let r=l(4);return p(r.confirmerDecision())}),a(9," Confirmer le rejet "),i(),n(10,"button",12),_("click",function(){u(e);let r=l(4);return p(r.annulerDecision())}),a(11," Annuler "),i()()()}if(o&2){let e=l(4);c(6),T("ngModel",e.explicationRejet),c(2),m("disabled",!e.explicationRejet.trim())}}function ue(o,t){if(o&1){let e=f();n(0,"div",40)(1,"div")(2,"label",20),a(3,"\xC9l\xE9ments manquants "),n(4,"span",103),a(5,"*"),i()(),n(6,"textarea",106),b("ngModelChange",function(r){u(e);let d=l(4);return S(d.complementDemande,r)||(d.complementDemande=r),p(r)}),i()(),n(7,"div",11)(8,"button",107),_("click",function(){u(e);let r=l(4);return p(r.confirmerDecision())}),a(9," Demander le compl\xE9ment "),i(),n(10,"button",12),_("click",function(){u(e);let r=l(4);return p(r.annulerDecision())}),a(11," Annuler "),i()()()}if(o&2){let e=l(4);c(6),T("ngModel",e.complementDemande),c(2),m("disabled",!e.complementDemande.trim())}}function pe(o,t){if(o&1){let e=f();n(0,"div",40)(1,"div")(2,"label",20),a(3,"Motif d'annulation "),n(4,"span",103),a(5,"*"),i()(),n(6,"textarea",108),b("ngModelChange",function(r){u(e);let d=l(4);return S(d.explicationAnnulation,r)||(d.explicationAnnulation=r),p(r)}),i()(),n(7,"div",11)(8,"button",109),_("click",function(){u(e);let r=l(4);return p(r.confirmerDecision())}),a(9," Confirmer l'annulation "),i(),n(10,"button",12),_("click",function(){u(e);let r=l(4);return p(r.annulerDecision())}),a(11," Annuler "),i()()()}if(o&2){let e=l(4);c(6),T("ngModel",e.explicationAnnulation),c(2),m("disabled",!e.explicationAnnulation.trim())}}function _e(o,t){if(o&1){let e=f();n(0,"div",112)(1,"div",113),g(),n(2,"svg",114),x(3,"path",115),i(),h(),n(4,"span",116),a(5),i()(),n(6,"button",117),_("click",function(){let r=u(e).index,d=l(5);return p(d.retirerFichier(r))}),a(7," Retirer "),i()()}if(o&2){let e=t.$implicit,s=l(5);c(5),I("",e.name," (",s.formatFileSize(e.size),")")}}function ve(o,t){if(o&1&&(n(0,"div",68)(1,"h4",110),a(2,"Fichiers s\xE9lectionn\xE9s :"),i(),n(3,"div",54),v(4,_e,8,2,"div",111),i()()),o&2){let e=l(4);c(4),m("ngForOf",e.fichiersJustificatifs)}}function ge(o,t){if(o&1){let e=f();n(0,"div",95)(1,"h3",49),a(2),i(),v(3,me,10,1,"div",96)(4,de,12,2,"div",96)(5,ue,12,2,"div",96)(6,pe,12,2,"div",96),n(7,"div",97)(8,"label",20),a(9,"Fichiers justificatifs (optionnel)"),i(),n(10,"div",98)(11,"input",99),_("change",function(r){u(e);let d=l(3);return p(d.onFileSelect(r))}),i(),n(12,"p",100),a(13," Formats accept\xE9s : PDF, DOC, DOCX, JPG, PNG (Max 5MB par fichier) "),i()(),v(14,ve,5,1,"div",10),i()()}if(o&2){let e=l(3);c(2),E(" ",e.getDecisionTitle()," "),c(),m("ngIf",e.decisionSuperviseur==="VALIDER"),c(),m("ngIf",e.decisionSuperviseur==="REJETER"),c(),m("ngIf",e.decisionSuperviseur==="COMPLEMENT"),c(),m("ngIf",e.decisionSuperviseur==="ANNULER"),c(8),m("ngIf",e.fichiersJustificatifs.length>0)}}function xe(o,t){if(o&1){let e=f();n(0,"div",17),a(1,"> "),n(2,"div",84)(3,"h2",85),a(4,"D\xE9cision Superviseur"),i(),n(5,"span",86),a(6),i()(),n(7,"div",87)(8,"button",88),_("click",function(){u(e);let r=l(2);return p(r.preparerDecision("VALIDER"))}),g(),n(9,"svg",13),x(10,"path",67),i(),a(11," Valider "),i(),h(),n(12,"button",89),_("click",function(){u(e);let r=l(2);return p(r.preparerDecision("REJETER"))}),g(),n(13,"svg",13),x(14,"path",63),i(),a(15," Rejeter "),i(),h(),n(16,"button",90),_("click",function(){u(e);let r=l(2);return p(r.preparerDecision("COMPLEMENT"))}),g(),n(17,"svg",13),x(18,"path",91),i(),a(19," Demander compl\xE9ment "),i(),h(),n(20,"button",92),_("click",function(){u(e);let r=l(2);return p(r.preparerDecision("ANNULER"))}),g(),n(21,"svg",13),x(22,"path",93),i(),a(23," Annuler "),i()(),v(24,ge,15,6,"div",94),i()}if(o&2){let e=l(2);c(6),E(" ",e.isRecours?"Recours":"Ticket"," en attente de traitement "),c(18),m("ngIf",e.showDecisionSection)}}function Ee(o,t){if(o&1&&(n(0,"div")(1,"span",123),a(2,"D\xE9but:"),i(),a(3),w(4,"date"),i()),o&2){let e=l().$implicit;c(3),E(" ",y(4,1,e.dateDebut,"short")," ")}}function fe(o,t){if(o&1&&(n(0,"div")(1,"span",123),a(2,"Fin:"),i(),a(3),w(4,"date"),i()),o&2){let e=l().$implicit;c(3),E(" ",y(4,1,e.dateFin,"short")," ")}}function he(o,t){if(o&1){let e=f();n(0,"button",134),_("click",function(){u(e);let r=l(2).$implicit,d=l(2);return p(d.demarrerEtape(r))}),a(1," D\xE9marrer "),i()}}function Ce(o,t){if(o&1){let e=f();n(0,"button",135),_("click",function(){u(e);let r=l(2).$implicit,d=l(2);return p(d.terminerEtape(r))}),a(1," Terminer "),i()}}function Te(o,t){if(o&1){let e=f();n(0,"button",136),_("click",function(){u(e);let r=l(2).$implicit,d=l(2);return p(d.bloquerEtape(r))}),a(1," Bloquer "),i()}}function Se(o,t){if(o&1&&(n(0,"div",137),g(),n(1,"svg",138),x(2,"path",139),i(),a(3),i()),o&2){let e=l(2).$implicit;c(3),E(" Cette \xE9tape est assign\xE9e \xE0 ",e.assigneA," ")}}function be(o,t){if(o&1&&(n(0,"div",68)(1,"div",129),v(2,he,2,0,"button",130)(3,Ce,2,0,"button",131)(4,Te,2,0,"button",132),i(),v(5,Se,4,1,"div",133),i()),o&2){let e=l().$implicit,s=l(2);c(2),m("ngIf",e.statut==="EN_ATTENTE"&&s.canManageEtape(e)),c(),m("ngIf",e.statut==="EN_COURS"&&s.canManageEtape(e)),c(),m("ngIf",e.statut==="EN_COURS"&&s.canManageEtape(e)),c(),m("ngIf",!s.canManageEtape(e)&&(e.statut==="EN_COURS"||e.statut==="EN_ATTENTE"))}}function Ve(o,t){if(o&1&&(n(0,"div",118)(1,"div",119)(2,"div",113)(3,"div",120),g(),n(4,"svg",121),x(5,"path",122),i()(),h(),n(6,"div")(7,"h3",123),a(8),i(),n(9,"p",124),a(10),i()()(),n(11,"span",125),a(12),i()(),n(13,"div",126)(14,"div",127)(15,"div")(16,"span",123),a(17,"Assign\xE9 \xE0:"),i(),a(18),i(),v(19,Ee,5,4,"div",128)(20,fe,5,4,"div",128),i(),v(21,be,6,4,"div",10),i()()),o&2){let e=t.$implicit,s=l(2);m("ngClass",s.getEtapeClass(e.statut)),c(3),m("ngClass",s.getEtapeIconClass(e.statut)),c(2),N("d",s.getEtapeIcon(e.statut)),c(3),C(e.nom),c(2),C(e.description),c(),m("ngClass",s.getStatutBadgeClass(e.statut)),c(),E(" ",s.getStatutLabel(e.statut)," "),c(6),E(" ",e.assigneA," "),c(),m("ngIf",e.dateDebut),c(),m("ngIf",e.dateFin),c(),m("ngIf",e.statut==="EN_COURS"||e.statut==="EN_ATTENTE")}}function Re(o,t){if(o&1){let e=f();n(0,"div",147)(1,"textarea",148),b("ngModelChange",function(r){u(e);let d=l(4);return S(d.commentaireValidation1,r)||(d.commentaireValidation1=r),p(r)}),i(),n(2,"div",129)(3,"button",102),_("click",function(){u(e);let r=l(4);return p(r.validerNiveau1(!0))}),a(4,"Valider"),i(),n(5,"button",149),_("click",function(){u(e);let r=l(4);return p(r.validerNiveau1(!1))}),a(6,"Rejeter"),i()()()}if(o&2){let e=l(4);c(),T("ngModel",e.commentaireValidation1)}}function we(o,t){o&1&&(n(0,"div",150),g(),n(1,"svg",138),x(2,"path",151),i(),a(3," Validation niveau 1 requise - R\xE9serv\xE9e aux superviseurs "),i())}function ye(o,t){if(o&1&&(n(0,"p")(1,"strong"),a(2,"Commentaire:"),i(),a(3),i()),o&2){let e=l(5);c(3),E(" ",e.item.validation.niveau1.commentaire)}}function Ie(o,t){if(o&1&&(n(0,"div",116)(1,"p")(2,"strong"),a(3,"Valid\xE9 par:"),i(),a(4),i(),n(5,"p")(6,"strong"),a(7,"Date:"),i(),a(8),w(9,"date"),i(),v(10,ye,4,1,"p",128),i()),o&2){let e=l(4);c(4),E(" ",e.item.validation.niveau1.validePar),c(4),E(" ",y(9,3,e.item.validation.niveau1.dateValidation,"short")),c(2),m("ngIf",e.item.validation.niveau1.commentaire)}}function Ae(o,t){if(o&1&&(n(0,"div",142)(1,"div",143)(2,"h3",123),a(3,"Validation Niveau 1"),i(),n(4,"span",125),a(5),i()(),v(6,Re,7,1,"div",144)(7,we,4,0,"div",145)(8,Ie,11,6,"div",146),i()),o&2){let e=l(3);c(4),m("ngClass",e.getValidationBadgeClass(e.item.validation.niveau1.statut)),c(),E(" ",e.getValidationLabel(e.item.validation.niveau1.statut)," "),c(),m("ngIf",e.item.validation.niveau1.statut==="EN_ATTENTE"&&e.canValidateNiveau1),c(),m("ngIf",e.item.validation.niveau1.statut==="EN_ATTENTE"&&!e.canValidateNiveau1),c(),m("ngIf",e.item.validation.niveau1.statut!=="EN_ATTENTE")}}function Ne(o,t){if(o&1){let e=f();n(0,"div",147)(1,"textarea",154),b("ngModelChange",function(r){u(e);let d=l(4);return S(d.commentaireValidation2,r)||(d.commentaireValidation2=r),p(r)}),i(),n(2,"div",129)(3,"button",102),_("click",function(){u(e);let r=l(4);return p(r.validerNiveau2(!0))}),a(4,"Valider"),i(),n(5,"button",149),_("click",function(){u(e);let r=l(4);return p(r.validerNiveau2(!1))}),a(6,"Rejeter"),i()()()}if(o&2){let e=l(4);c(),T("ngModel",e.commentaireValidation2)}}function ke(o,t){o&1&&(n(0,"div",150),g(),n(1,"svg",138),x(2,"path",151),i(),a(3," Validation niveau 2 requise - R\xE9serv\xE9e aux superviseurs et managers "),i())}function Me(o,t){o&1&&(n(0,"div",155),g(),n(1,"svg",138),x(2,"path",139),i(),a(3," En attente de la validation niveau 1 "),i())}function De(o,t){if(o&1&&(n(0,"p")(1,"strong"),a(2,"Commentaire:"),i(),a(3),i()),o&2){let e=l(5);c(3),E(" ",e.item.validation.niveau2.commentaire)}}function Ue(o,t){if(o&1&&(n(0,"div",116)(1,"p")(2,"strong"),a(3,"Valid\xE9 par:"),i(),a(4),i(),n(5,"p")(6,"strong"),a(7,"Date:"),i(),a(8),w(9,"date"),i(),v(10,De,4,1,"p",128),i()),o&2){let e=l(4);c(4),E(" ",e.item.validation.niveau2.validePar),c(4),E(" ",y(9,3,e.item.validation.niveau2.dateValidation,"short")),c(2),m("ngIf",e.item.validation.niveau2.commentaire)}}function Le(o,t){if(o&1&&(n(0,"div",152)(1,"div",143)(2,"h3",123),a(3,"Validation Niveau 2"),i(),n(4,"span",125),a(5),i()(),v(6,Ne,7,1,"div",144)(7,ke,4,0,"div",145)(8,Me,4,0,"div",153)(9,Ue,11,6,"div",146),i()),o&2){let e=l(3);c(4),m("ngClass",e.getValidationBadgeClass(e.item.validation.niveau2.statut)),c(),E(" ",e.getValidationLabel(e.item.validation.niveau2.statut)," "),c(),m("ngIf",e.item.validation.niveau2.statut==="EN_ATTENTE"&&e.item.validation.niveau1.statut==="VALIDE"&&e.canValidateNiveau2),c(),m("ngIf",e.item.validation.niveau2.statut==="EN_ATTENTE"&&e.item.validation.niveau1.statut==="VALIDE"&&!e.canValidateNiveau2),c(),m("ngIf",e.item.validation.niveau2.statut==="EN_ATTENTE"&&e.item.validation.niveau1.statut!=="VALIDE"),c(),m("ngIf",e.item.validation.niveau2.statut!=="EN_ATTENTE")}}function je(o,t){if(o&1&&(n(0,"div",17)(1,"h2",18),a(2,"Validation"),i(),v(3,Ae,9,5,"div",140)(4,Le,10,6,"div",141),i()),o&2){let e=l(2);c(3),m("ngIf",e.item.validation.niveau1.requis),c(),m("ngIf",e.item.validation.niveau2.requis)}}function Oe(o,t){if(o&1&&(n(0,"div",156)(1,"div",157)(2,"span",123),a(3),i(),n(4,"div",158)(5,"span",125),a(6),i(),n(7,"span",159),a(8),w(9,"date"),i()()(),n(10,"p",160),a(11),i()()),o&2){let e=t.$implicit,s=l(2);m("ngClass",s.getCommentaireBorderClass(e.type)),c(3),C(e.auteur),c(2),m("ngClass",s.getCommentaireTypeClass(e.type)),c(),E(" ",e.type," "),c(2),C(y(9,6,e.date,"short")),c(3),C(e.contenu)}}function Fe(o,t){if(o&1&&(n(0,"div",51)(1,"span",52),a(2,"Montant:"),i(),n(3,"span"),a(4),w(5,"currency"),i()()),o&2){let e=l(2);c(4),C(k(5,1,e.item.montantConteste,"FCFA","symbol","1.0-0"))}}function Pe(o,t){if(o&1){let e=f();n(0,"div",161)(1,"div",113),g(),n(2,"svg",114),x(3,"path",115),i(),h(),n(4,"span",116),a(5),i()(),n(6,"button",162),_("click",function(){let r=u(e).$implicit,d=l(2);return p(d.telechargerFichier(r))}),a(7," T\xE9l\xE9charger "),i()()}if(o&2){let e=t.$implicit;c(5),C(e.nom)}}function Be(o,t){if(o&1){let e=f();n(0,"div",1)(1,"div",2)(2,"button",3),_("click",function(){u(e);let r=l();return p(r.retourAuDetail())}),g(),n(3,"svg",4),x(4,"path",5),i(),a(5," \u2190 Retour au d\xE9tail de la demande "),i()(),h(),n(6,"div",6)(7,"div",7)(8,"div")(9,"h1",8),a(10),i(),n(11,"p",9),a(12),i(),v(13,se,8,6,"div",10),i(),n(14,"div",11)(15,"button",12),_("click",function(){u(e);let r=l();return p(r.exportPDF())}),g(),n(16,"svg",13),x(17,"path",14),i(),a(18," Exporter PDF "),i(),h(),n(19,"button",12),_("click",function(){u(e);let r=l();return p(r.goBack())}),a(20,"Retour"),i()()()(),n(21,"div",15)(22,"div",16)(23,"div",17)(24,"h2",18),a(25,"Informations g\xE9n\xE9rales"),i(),n(26,"div",19)(27,"div")(28,"label",20),a(29,"Statut"),i(),n(30,"select",21),b("ngModelChange",function(r){u(e);let d=l();return S(d.item.statut,r)||(d.item.statut=r),p(r)}),_("change",function(){u(e);let r=l();return p(r.onStatutChange())}),n(31,"option",22),a(32,"Nouveau"),i(),n(33,"option",23),a(34,"En cours"),i(),n(35,"option",24),a(36,"En attente validation"),i(),n(37,"option",25),a(38,"Valid\xE9"),i(),n(39,"option",26),a(40,"Rejet\xE9"),i(),n(41,"option",27),a(42,"R\xE9solu"),i(),n(43,"option",28),a(44,"Annul\xE9"),i(),n(45,"option",29),a(46,"Ferm\xE9"),i()()(),n(47,"div")(48,"label",20),a(49,"Priorit\xE9"),i(),n(50,"select",30),b("ngModelChange",function(r){u(e);let d=l();return S(d.item.priorite,r)||(d.item.priorite=r),p(r)}),n(51,"option",31),a(52,"Basse"),i(),n(53,"option",32),a(54,"Normale"),i(),n(55,"option",33),a(56,"Haute"),i(),n(57,"option",34),a(58,"Critique"),i()()(),n(59,"div")(60,"label",20),a(61,"Assign\xE9 \xE0"),i(),n(62,"select",30),b("ngModelChange",function(r){u(e);let d=l();return S(d.item.assigneA,r)||(d.item.assigneA=r),p(r)}),n(63,"option",35),a(64,"S\xE9lectionner un agent"),i(),v(65,ce,2,2,"option",36),i()(),n(66,"div")(67,"label",20),a(68,"Date limite"),i(),n(69,"input",37),b("ngModelChange",function(r){u(e);let d=l();return S(d.delaiReponseString,r)||(d.delaiReponseString=r),p(r)}),i()()(),v(70,le,4,1,"div",38),i(),v(71,xe,25,2,"div",39),n(72,"div",17)(73,"h2",18),a(74,"\xC9tapes de traitement"),i(),n(75,"div",40),v(76,Ve,22,11,"div",41),i()(),v(77,je,5,2,"div",39),n(78,"div",17)(79,"h2",18),a(80,"Commentaires et historique"),i(),n(81,"div",2)(82,"div",42)(83,"button",43),_("click",function(){u(e);let r=l();return p(r.typeCommentaire="COMMENTAIRE")}),a(84,"Commentaire"),i(),n(85,"button",43),_("click",function(){u(e);let r=l();return p(r.typeCommentaire="DECISION")}),a(86,"D\xE9cision"),i(),n(87,"button",43),_("click",function(){u(e);let r=l();return p(r.typeCommentaire="ESCALADE")}),a(88,"Escalade"),i()(),n(89,"textarea",44),b("ngModelChange",function(r){u(e);let d=l();return S(d.nouveauCommentaire,r)||(d.nouveauCommentaire=r),p(r)}),i(),n(90,"button",45),_("click",function(){u(e);let r=l();return p(r.ajouterCommentaire())}),a(91," Ajouter commentaire "),i()(),n(92,"div",40),v(93,Oe,12,9,"div",46),i()()(),n(94,"div",47)(95,"div",48)(96,"h3",49),a(97,"Informations rapides"),i(),n(98,"div",50)(99,"div",51)(100,"span",52),a(101,"Cr\xE9\xE9 le:"),i(),n(102,"span"),a(103),w(104,"date"),i()(),n(105,"div",51)(106,"span",52),a(107,"Demandeur:"),i(),n(108,"span"),a(109),i()(),n(110,"div",51)(111,"span",52),a(112,"Type:"),i(),n(113,"span"),a(114),i()(),v(115,Fe,6,6,"div",53),i()(),n(116,"div",48)(117,"h3",49),a(118,"Fichiers joints"),i(),n(119,"div",54),v(120,Pe,8,1,"div",55),i()(),n(121,"div",48)(122,"h3",49),a(123,"Actions rapides"),i(),n(124,"div",54)(125,"button",56),_("click",function(){u(e);let r=l();return p(r.escalader())}),g(),n(126,"svg",13),x(127,"path",57),i(),a(128," Escalader "),i(),h(),n(129,"button",58),_("click",function(){u(e);let r=l();return p(r.reassigner())}),g(),n(130,"svg",13),x(131,"path",59),i(),a(132," R\xE9assigner "),i(),h(),n(133,"button",60),_("click",function(){u(e);let r=l();return p(r.suspendre())}),g(),n(134,"svg",13),x(135,"path",61),i(),a(136," Suspendre "),i(),h(),n(137,"button",62),_("click",function(){u(e);let r=l();return p(r.fermer())}),g(),n(138,"svg",13),x(139,"path",63),i(),a(140," Fermer "),i()()()()(),h(),n(141,"div",64)(142,"button",65),_("click",function(){u(e);let r=l();return p(r.sauvegarder())}),g(),n(143,"svg",66),x(144,"path",67),i(),a(145," Sauvegarder "),i()()()}if(o&2){let e=l();c(10),I(" \u{1F527} Traitement ",e.isRecours?"Recours":"Ticket"," #",e.item.numero," "),c(2),C(e.item.description),c(),m("ngIf",e.currentUser),c(17),T("ngModel",e.item.statut),m("disabled",!e.canModifyStatus()),c(20),T("ngModel",e.item.priorite),c(12),T("ngModel",e.item.assigneA),c(3),m("ngForOf",e.agents),c(4),T("ngModel",e.delaiReponseString),c(),m("ngIf",e.isRecours),c(),m("ngIf",e.showDecisionSuperviseur()),c(5),m("ngForOf",e.item.etapesTraitement),c(),m("ngIf",e.isRecours&&e.item.validation),c(6),m("ngClass",e.typeCommentaire==="COMMENTAIRE"?"btn-primary":"btn-secondary"),c(2),m("ngClass",e.typeCommentaire==="DECISION"?"btn-primary":"btn-secondary"),c(2),m("ngClass",e.typeCommentaire==="ESCALADE"?"btn-primary":"btn-secondary"),c(2),T("ngModel",e.nouveauCommentaire),c(),m("disabled",!e.nouveauCommentaire.trim()),c(3),m("ngForOf",e.item.commentaires),c(10),C(y(104,25,e.item.dateCreation,"short")),c(6),C(e.item.demandeur),c(5),C(e.item.typeRecours),c(),m("ngIf",e.isRecours),c(5),m("ngForOf",e.item.fichiers)}}var ie=class o{constructor(t,e,s,r,d,qe,ze){this.route=t;this.router=e;this.toastService=s;this.modalService=r;this.authService=d;this.recoursService=qe;this.ticketService=ze}item=null;isRecours=!0;typeCommentaire="COMMENTAIRE";nouveauCommentaire="";commentaireValidation1="";commentaireValidation2="";delaiReponseString="";currentUser=null;canValidateNiveau1=!1;canValidateNiveau2=!1;canAssignToOthers=!1;canCloseRecours=!1;canEscalade=!1;decisionSuperviseur="";explicationRejet="";explicationAnnulation="";complementDemande="";fichiersJustificatifs=[];showDecisionSection=!1;agents=[{nom:"Jean Kouassi",email:"jean.kouassi@anare-ci.org"},{nom:"Marie Dupont",email:"marie.dupont@anare-ci.org"},{nom:"Paul Martin",email:"paul.martin@anare-ci.org"},{nom:"Superviseur Recours",email:"superviseur.recours@anare-ci.org"}];retourAuDetail(){this.item&&(this.isRecours?this.router.navigate(["/recours",this.item.id]):this.router.navigate(["/tickets",this.item.id]))}ngOnInit(){if(console.log("=== DEBUT ngOnInit ==="),this.currentUser=this.authService.getCurrentUser(),console.log("Utilisateur r\xE9cup\xE9r\xE9:",this.currentUser),!this.currentUser){console.error("Aucun utilisateur connect\xE9, redirection vers login"),this.router.navigate(["/login"]);return}this.route.params.subscribe(t=>{let e=t.id,s=this.router.url;console.log("URL compl\xE8te:",s),this.isRecours=s.includes("/recours/"),console.log("Route params:",{id:e,fullUrl:s,isRecours:this.isRecours}),this.setPermissions(),this.loadItem(e),console.log("=== FIN ngOnInit ===")})}setPermissions(){if(!this.currentUser){console.warn("Aucun utilisateur pour d\xE9finir les permissions");return}let t=this.currentUser.role;switch(console.log("Utilisateur connect\xE9:",this.currentUser.nom,this.currentUser.prenom,"- R\xF4le:",t),t){case"SUPERVISEUR_RECOURS":this.canValidateNiveau1=this.isRecours,this.canValidateNiveau2=this.isRecours,this.canAssignToOthers=this.isRecours,this.canCloseRecours=this.isRecours,this.canEscalade=!0,console.log("\u2705 Permissions SUPERVISEUR RECOURS accord\xE9es pour:",this.isRecours?"Recours":"Tickets");break;case"SUPERVISEUR_IT":this.canValidateNiveau1=!this.isRecours,this.canValidateNiveau2=!this.isRecours,this.canAssignToOthers=!this.isRecours,this.canCloseRecours=!this.isRecours,this.canEscalade=!0,console.log("\u2705 Permissions SUPERVISEUR IT accord\xE9es pour:",this.isRecours?"Recours":"Tickets");break;case"ADMIN":this.canValidateNiveau1=!0,this.canValidateNiveau2=!0,this.canAssignToOthers=!0,this.canCloseRecours=!0,this.canEscalade=!0,console.log("\u2705 Permissions ADMIN accord\xE9es (tous types)");break;case"AGENT_RECOURS":case"TECHNICIEN_IT":this.canValidateNiveau1=!1,this.canValidateNiveau2=!1,this.canAssignToOthers=!1,this.canCloseRecours=!1,this.canEscalade=!0,console.log("\u26A0\uFE0F Permissions AGENT accord\xE9es (limit\xE9es)");break;case"UTILISATEUR":default:console.log("\u274C Aucune permission accord\xE9e (Utilisateur standard)");break}console.log("Permissions d\xE9finies:",{canValidateNiveau1:this.canValidateNiveau1,canValidateNiveau2:this.canValidateNiveau2,canAssignToOthers:this.canAssignToOthers,canCloseRecours:this.canCloseRecours,canEscalade:this.canEscalade,typeDocument:this.isRecours?"Recours":"Ticket"})}loadItem(t){console.log("Chargement de l'item avec ID:",t,"Type:",this.isRecours?"Recours":"Ticket"),this.isRecours?this.recoursService.getRecoursById(t).subscribe({next:e=>{e?this.canAccessItem(e)?(this.item=this.convertRecoursToTraitementRecours(e),this.delaiReponseString=this.formatDateForInput(this.item.delaiReponse),console.log("Recours charg\xE9 avec succ\xE8s:",this.item)):(this.toastService.error("Acc\xE8s refus\xE9","Vous n'avez pas le droit d'acc\xE9der \xE0 ce recours"),this.router.navigate(["/recours"])):(this.toastService.error("Recours introuvable","Le recours demand\xE9 n'existe pas"),this.router.navigate(["/recours"]))},error:e=>{console.error("Erreur lors du chargement du recours:",e),this.toastService.error("Erreur","Impossible de charger le recours"),this.router.navigate(["/recours"])}}):this.ticketService.getTicketById(t).subscribe({next:e=>{e?this.canAccessItem(e)?(this.item=this.convertTicketToTraitementRecours(e),this.delaiReponseString=this.formatDateForInput(this.item.delaiReponse),console.log("Ticket charg\xE9 avec succ\xE8s:",this.item)):(this.toastService.error("Acc\xE8s refus\xE9","Vous n'avez pas le droit d'acc\xE9der \xE0 ce ticket"),this.router.navigate(["/tickets"])):(this.toastService.error("Ticket introuvable","Le ticket demand\xE9 n'existe pas"),this.router.navigate(["/tickets"]))},error:e=>{console.error("Erreur lors du chargement du ticket:",e),this.toastService.error("Erreur","Impossible de charger le ticket"),this.router.navigate(["/tickets"])}})}canAccessItem(t){if(!this.currentUser)return console.log("\u274C Acc\xE8s refus\xE9 : aucun utilisateur connect\xE9"),!1;let e=this.currentUser.email,s=this.currentUser.role;return console.log("\u{1F50D} V\xE9rification d'acc\xE8s:",{userEmail:e,userRole:s,itemType:this.isRecours?"Recours":"Ticket",itemId:t.id}),s==="ADMIN"?(console.log("\u2705 Acc\xE8s autoris\xE9 : Admin"),!0):s==="SUPERVISEUR_RECOURS"&&this.isRecours?(console.log("\u2705 Acc\xE8s autoris\xE9 : Superviseur Recours"),!0):s==="SUPERVISEUR_IT"&&!this.isRecours?(console.log("\u2705 Acc\xE8s autoris\xE9 : Superviseur IT"),!0):(s==="AGENT_RECOURS"||s==="TECHNICIEN_IT")&&"assigneA"in t&&t.assigneA===e?(console.log("\u2705 Acc\xE8s autoris\xE9 : Agent/Technicien assign\xE9 \xE0 cette demande"),!0):s==="UTILISATEUR"?(console.log("\u{1F512} Utilisateur standard - V\xE9rification de propri\xE9t\xE9"),"clientEmail"in t&&t.clientEmail===e?(console.log("\u2705 Acc\xE8s autoris\xE9 : Cr\xE9ateur de la demande (clientEmail)",{itemClientEmail:t.clientEmail,userEmail:e}),!0):"requrantEmail"in t&&t.requrantEmail===e?(console.log("\u2705 Acc\xE8s autoris\xE9 : Cr\xE9ateur de la demande (requrantEmail)",{itemRequrantEmail:t.requrantEmail,userEmail:e}),!0):"demandeurEmail"in t&&t.demandeurEmail===e?(console.log("\u2705 Acc\xE8s autoris\xE9 : Cr\xE9ateur de la demande (demandeurEmail)",{itemDemandeurEmail:t.demandeurEmail,userEmail:e}),!0):(console.log("\u274C Acc\xE8s refus\xE9 pour utilisateur standard - Pas le cr\xE9ateur de la demande:",{userEmail:e,itemEmails:{clientEmail:"clientEmail"in t?t.clientEmail:"N/A",requrantEmail:"requrantEmail"in t?t.requrantEmail:"N/A",demandeurEmail:"demandeurEmail"in t?t.demandeurEmail:"N/A"}}),!1)):(console.log("\u274C Acc\xE8s refus\xE9 :",{userEmail:e,userRole:s,itemType:this.isRecours?"Recours":"Ticket",reason:"R\xF4le non autoris\xE9 ou conditions non remplies"}),!1)}convertRecoursToTraitementRecours(t){return{id:parseInt(t.id),numero:t.numero,typeRecours:t.type,statut:t.statut,priorite:t.priorite,description:t.description,montantConteste:t.montantLitige||0,demandeur:t.clientNom||t.requrantNom+" "+t.requrantPrenom,dateCreation:t.dateCreation,delaiReponse:t.dateEcheance||new Date(Date.now()+30*24*60*60*1e3),assigneA:t.assigneA||"",clientEmail:t.clientEmail,requrantEmail:t.requrantEmail,etapesTraitement:this.createDefaultEtapes(),fichiers:t.fichiers||[],commentaires:this.convertCommentaires(t.commentaires||[]),validation:{niveau1:{requis:!0,statut:"EN_ATTENTE"},niveau2:{requis:!0,statut:"EN_ATTENTE"}}}}convertTicketToTraitementRecours(t){return{id:parseInt(t.id),numero:t.numero,typeRecours:t.type,statut:t.statut,priorite:t.priorite,description:t.description,montantConteste:0,demandeur:t.demandeurNom||t.demandeur,dateCreation:t.dateCreation,delaiReponse:new Date(t.dateCreation.getTime()+(t.sla?.tempsResolution||24)*60*60*1e3),assigneA:"",demandeurEmail:t.demandeurEmail,etapesTraitement:this.createDefaultEtapes(),fichiers:[],commentaires:[],validation:void 0}}createDefaultEtapes(){return[{id:1,nom:"Analyse initiale",description:"Analyse et classification de la demande",statut:"TERMINE",assigneA:this.currentUser?.email||"",dateDebut:new Date(Date.now()-2*24*60*60*1e3),dateFin:new Date(Date.now()-1.5*24*60*60*1e3),obligatoire:!0},{id:2,nom:"Investigation",description:"Investigation approfondie",statut:"EN_COURS",assigneA:this.currentUser?.email||"",dateDebut:new Date(Date.now()-1.5*24*60*60*1e3),obligatoire:!0},{id:3,nom:"Validation",description:"Validation par le superviseur",statut:"EN_ATTENTE",assigneA:"superviseur.recours@anare-ci.org",obligatoire:!0}]}convertCommentaires(t){return t.map(e=>({id:e.id||Math.random(),auteur:e.auteur||"Utilisateur",contenu:e.contenu||e.message||"",date:e.date||new Date,type:e.type||"COMMENTAIRE"}))}formatDateForInput(t){return t.toISOString().slice(0,16)}onStatutChange(){this.item&&console.log("Statut chang\xE9:",this.item.statut)}demarrerEtape(t){t.statut="EN_COURS",t.dateDebut=new Date,console.log("\xC9tape d\xE9marr\xE9e:",t)}terminerEtape(t){t.statut="TERMINE",t.dateFin=new Date,console.log("\xC9tape termin\xE9e:",t)}bloquerEtape(t){t.statut="BLOQUE",console.log("\xC9tape bloqu\xE9e:",t)}validerNiveau1(t){if(!this.canValidateNiveau1){this.toastService.error("Acc\xE8s refus\xE9","Vous n'avez pas les permissions pour valider ce niveau");return}if(this.item?.validation){this.item.validation.niveau1.statut=t?"VALIDE":"REJETE",this.item.validation.niveau1.validePar=this.currentUser?.nom+" "+this.currentUser?.prenom,this.item.validation.niveau1.dateValidation=new Date,this.item.validation.niveau1.commentaire=this.commentaireValidation1,this.commentaireValidation1="";let e=t?"valid\xE9":"rejet\xE9";this.toastService.success("Validation niveau 1",`Le recours a \xE9t\xE9 ${e} au niveau 1`),!t&&this.item&&(this.item.statut="REJETE")}}validerNiveau2(t){if(!this.canValidateNiveau2){this.toastService.error("Acc\xE8s refus\xE9","Vous n'avez pas les permissions pour valider ce niveau");return}if(this.item?.validation){this.item.validation.niveau2.statut=t?"VALIDE":"REJETE",this.item.validation.niveau2.validePar=this.currentUser?.nom+" "+this.currentUser?.prenom,this.item.validation.niveau2.dateValidation=new Date,this.item.validation.niveau2.commentaire=this.commentaireValidation2,this.commentaireValidation2="";let e=t?"valid\xE9":"rejet\xE9";this.toastService.success("Validation niveau 2",`Le recours a \xE9t\xE9 ${e} au niveau 2`),t&&this.item?this.item.statut="RESOLU":!t&&this.item&&(this.item.statut="REJETE")}}ajouterCommentaire(){if(this.nouveauCommentaire.trim()&&this.item){let t={id:this.item.commentaires.length+1,auteur:this.currentUser?.nom+" "+this.currentUser?.prenom||"Utilisateur",contenu:this.nouveauCommentaire,date:new Date,type:this.typeCommentaire};this.item.commentaires.push(t),this.nouveauCommentaire="",this.toastService.success("Commentaire ajout\xE9","Votre commentaire a \xE9t\xE9 ajout\xE9 avec succ\xE8s")}}approuverRecours(){return V(this,null,function*(){if(!this.canValidateNiveau2){this.toastService.error("Acc\xE8s refus\xE9","Vous n'avez pas les permissions pour approuver ce recours");return}if((yield this.modalService.confirm("Approuver le recours","Voulez-vous approuver d\xE9finitivement ce recours ?",{type:"success",confirmText:"Approuver",cancelText:"Annuler"}))&&this.item){this.item.statut="VALIDE";let e={id:this.item.commentaires.length+1,auteur:this.currentUser?.nom+" "+this.currentUser?.prenom||"Superviseur",contenu:"Recours approuv\xE9 par le superviseur",date:new Date,type:"DECISION"};this.item.commentaires.push(e),this.toastService.success("Recours approuv\xE9","Le recours a \xE9t\xE9 approuv\xE9 avec succ\xE8s")}})}rejeterRecours(){return V(this,null,function*(){if(!this.canValidateNiveau1&&!this.canValidateNiveau2){this.toastService.error("Acc\xE8s refus\xE9","Vous n'avez pas les permissions pour rejeter ce recours");return}if((yield this.modalService.confirm("Rejeter le recours","Voulez-vous rejeter d\xE9finitivement ce recours ?",{type:"danger",confirmText:"Rejeter",cancelText:"Annuler"}))&&this.item){this.item.statut="REJETE";let e={id:this.item.commentaires.length+1,auteur:this.currentUser?.nom+" "+this.currentUser?.prenom||"Superviseur",contenu:"Recours rejet\xE9 par le superviseur",date:new Date,type:"DECISION"};this.item.commentaires.push(e),this.toastService.warning("Recours rejet\xE9","Le recours a \xE9t\xE9 rejet\xE9")}})}marquerResolu(){return V(this,null,function*(){if(!this.canCloseRecours){this.toastService.error("Acc\xE8s refus\xE9","Vous n'avez pas les permissions pour marquer ce recours comme r\xE9solu");return}if((yield this.modalService.confirm("Marquer comme r\xE9solu","Voulez-vous marquer ce recours comme r\xE9solu ?",{type:"success",confirmText:"R\xE9solu",cancelText:"Annuler"}))&&this.item){this.item.statut="RESOLU",this.item.etapesTraitement.forEach(s=>{s.statut!=="TERMINE"&&(s.statut="TERMINE",s.dateFin=new Date)});let e={id:this.item.commentaires.length+1,auteur:this.currentUser?.nom+" "+this.currentUser?.prenom||"Superviseur",contenu:"Recours marqu\xE9 comme r\xE9solu par le superviseur",date:new Date,type:"DECISION"};this.item.commentaires.push(e),this.toastService.success("Recours r\xE9solu","Le recours a \xE9t\xE9 marqu\xE9 comme r\xE9solu")}})}escalader(){return V(this,null,function*(){if(!this.canEscalade){this.toastService.error("Acc\xE8s refus\xE9","Vous n'avez pas les permissions pour escalader ce recours");return}if((yield this.modalService.confirm("Escalader le recours","Voulez-vous escalader ce recours vers un niveau sup\xE9rieur ?",{type:"warning",confirmText:"Escalader",cancelText:"Annuler"}))&&this.item){this.item.priorite="HAUTE";let e={id:this.item.commentaires.length+1,auteur:this.currentUser?.nom+" "+this.currentUser?.prenom||"Utilisateur",contenu:"Recours escalad\xE9 vers un niveau sup\xE9rieur",date:new Date,type:"ESCALADE"};this.item.commentaires.push(e),this.toastService.info("Recours escalad\xE9","Le recours a \xE9t\xE9 escalad\xE9 avec succ\xE8s")}})}reassigner(){return V(this,null,function*(){if(!this.canAssignToOthers){this.toastService.error("Acc\xE8s refus\xE9","Vous n'avez pas les permissions pour r\xE9assigner ce recours");return}this.toastService.info("R\xE9assignation","Fonctionnalit\xE9 de r\xE9assignation disponible pour les superviseurs")})}suspendre(){console.log("Suspension du recours"),this.toastService.info("En d\xE9veloppement","Fonctionnalit\xE9 de suspension en cours de d\xE9veloppement...")}fermer(){return V(this,null,function*(){if(!this.canCloseRecours){this.toastService.error("Acc\xE8s refus\xE9","Vous n'avez pas les permissions pour fermer ce recours");return}if((yield this.modalService.confirm("Fermer le recours","\xCAtes-vous s\xFBr de vouloir fermer ce recours ?",{type:"danger",confirmText:"Fermer",cancelText:"Annuler"}))&&this.item){this.item.statut="FERME";let e={id:this.item.commentaires.length+1,auteur:this.currentUser?.nom+" "+this.currentUser?.prenom||"Superviseur",contenu:"Recours ferm\xE9 par le superviseur",date:new Date,type:"DECISION"};this.item.commentaires.push(e),this.toastService.success("Recours ferm\xE9","Le recours a \xE9t\xE9 ferm\xE9 avec succ\xE8s")}})}telechargerFichier(t){console.log("T\xE9l\xE9chargement du fichier:",t),this.toastService.info("T\xE9l\xE9chargement","T\xE9l\xE9chargement en cours...")}exportPDF(){console.log("Export PDF du recours"),this.toastService.info("Export PDF","Export PDF en cours de d\xE9veloppement...")}sauvegarder(){this.item&&(console.log("Sauvegarde du recours:",this.item),this.toastService.success("Sauvegard\xE9","Recours sauvegard\xE9 avec succ\xE8s !"))}goBack(){this.router.navigate([this.isRecours?"/recours":"/tickets"])}getEtapeClass(t){switch(t){case"TERMINE":return"bg-green-50 border-green-200";case"EN_COURS":return"bg-blue-50 border-blue-200";case"BLOQUE":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}}getEtapeIconClass(t){switch(t){case"TERMINE":return"bg-green-100 text-green-600";case"EN_COURS":return"bg-blue-100 text-blue-600";case"BLOQUE":return"bg-red-100 text-red-600";default:return"bg-gray-100 text-gray-600"}}getEtapeIcon(t){switch(t){case"TERMINE":return"M5 13l4 4L19 7";case"EN_COURS":return"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z";case"BLOQUE":return"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364L18.364 5.636";default:return"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"}}getStatutBadgeClass(t){switch(t){case"TERMINE":return"bg-green-100 text-green-800";case"EN_COURS":return"bg-blue-100 text-blue-800";case"BLOQUE":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}getStatutLabel(t){switch(t){case"EN_ATTENTE":return"En attente";case"EN_COURS":return"En cours";case"TERMINE":return"Termin\xE9";case"BLOQUE":return"Bloqu\xE9";default:return t}}getValidationBadgeClass(t){switch(t){case"VALIDE":return"bg-green-100 text-green-800";case"REJETE":return"bg-red-100 text-red-800";default:return"bg-yellow-100 text-yellow-800"}}getValidationLabel(t){switch(t){case"EN_ATTENTE":return"En attente";case"VALIDE":return"Valid\xE9";case"REJETE":return"Rejet\xE9";default:return t}}getCommentaireBorderClass(t){switch(t){case"DECISION":return"border-blue-400";case"ESCALADE":return"border-red-400";default:return"border-gray-300"}}getCommentaireTypeClass(t){switch(t){case"DECISION":return"bg-blue-100 text-blue-800";case"ESCALADE":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}getRoleBadgeClass(t){switch(t){case"ADMIN":return"bg-purple-100 text-purple-800";case"SUPERVISEUR_RECOURS":case"SUPERVISEUR_IT":return"bg-blue-100 text-blue-800";case"AGENT_RECOURS":case"TECHNICIEN_IT":return"bg-green-100 text-green-800";case"UTILISATEUR":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}}getRoleLabel(t){switch(t){case"ADMIN":return"Administrateur";case"SUPERVISEUR_RECOURS":return"Superviseur Recours";case"SUPERVISEUR_IT":return"Superviseur IT";case"AGENT_RECOURS":return"Agent Recours";case"TECHNICIEN_IT":return"Technicien IT";case"UTILISATEUR":return"Utilisateur";default:return"Utilisateur"}}canModifyStatus(){return this.canValidateNiveau1||this.canValidateNiveau2||this.canCloseRecours}canManageEtape(t){return this.currentUser?this.canValidateNiveau1||this.canValidateNiveau2?!0:t.assigneA===this.currentUser.email:!1}showDecisionSuperviseur(){if(!this.item||!this.currentUser)return!1;let t=this.canValidateNiveau1||this.canValidateNiveau2,s=["EN_COURS","NOUVEAU","EN_ATTENTE_VALIDATION"].includes(this.item.statut);return console.log("Debug showDecisionSuperviseur:",{hasPermissions:t,statusAllowed:s,currentStatus:this.item.statut,userRole:this.currentUser.role,isRecours:this.isRecours,canValidateNiveau1:this.canValidateNiveau1,canValidateNiveau2:this.canValidateNiveau2}),t&&s}preparerDecision(t){this.decisionSuperviseur=t,this.showDecisionSection=!0,this.commentaireValidation1="",this.explicationRejet="",this.explicationAnnulation="",this.complementDemande="",this.fichiersJustificatifs=[],console.log("Pr\xE9paration d\xE9cision:",t)}annulerDecision(){this.showDecisionSection=!1,this.decisionSuperviseur="",this.commentaireValidation1="",this.explicationRejet="",this.explicationAnnulation="",this.complementDemande="",this.fichiersJustificatifs=[]}confirmerDecision(){return V(this,null,function*(){if(!this.item)return;let t=!1,e="",s="info";switch(this.decisionSuperviseur){case"VALIDER":e=`Voulez-vous valider d\xE9finitivement ce ${this.isRecours?"recours":"ticket"} ?`,s="success";break;case"REJETER":if(!this.explicationRejet.trim()){this.toastService.error("Motif requis","Veuillez indiquer le motif du rejet");return}e=`Voulez-vous rejeter ce ${this.isRecours?"recours":"ticket"} ?`,s="danger";break;case"COMPLEMENT":if(!this.complementDemande.trim()){this.toastService.error("Pr\xE9cision requise","Veuillez pr\xE9ciser les \xE9l\xE9ments manquants");return}e="Voulez-vous demander un compl\xE9ment d'information ?",s="warning";break;case"ANNULER":if(!this.explicationAnnulation.trim()){this.toastService.error("Motif requis","Veuillez indiquer le motif d'annulation");return}e=`Voulez-vous annuler ce ${this.isRecours?"recours":"ticket"} ?`,s="danger";break}t=yield this.modalService.confirm("Confirmer la d\xE9cision",e,{type:s,confirmText:"Confirmer",cancelText:"Annuler"}),t&&this.executerDecision()})}executerDecision(){if(!this.item)return;let t=`${this.currentUser?.nom} ${this.currentUser?.prenom}`||"Superviseur";switch(this.decisionSuperviseur){case"VALIDER":this.item.statut="VALIDE",this.ajouterCommentaireDecision(`${this.isRecours?"Recours":"Ticket"} valid\xE9 par le superviseur`,this.commentaireValidation1||"Validation approuv\xE9e sans commentaire sp\xE9cifique"),this.toastService.success("Valid\xE9",`${this.isRecours?"Recours":"Ticket"} valid\xE9 avec succ\xE8s`);break;case"REJETER":this.item.statut="REJETE",this.ajouterCommentaireDecision(`${this.isRecours?"Recours":"Ticket"} rejet\xE9 par le superviseur`,`Motif du rejet : ${this.explicationRejet}`),this.toastService.warning("Rejet\xE9",`${this.isRecours?"Recours":"Ticket"} rejet\xE9`);break;case"COMPLEMENT":this.item.statut="EN_ATTENTE_VALIDATION",this.ajouterCommentaireDecision("Compl\xE9ment d'information demand\xE9",`\xC9l\xE9ments requis : ${this.complementDemande}`),this.toastService.info("Compl\xE9ment demand\xE9","Demande de compl\xE9ment envoy\xE9e");break;case"ANNULER":this.item.statut="ANNULE",this.ajouterCommentaireDecision(`${this.isRecours?"Recours":"Ticket"} annul\xE9 par le superviseur`,`Motif d'annulation : ${this.explicationAnnulation}`),this.toastService.warning("Annul\xE9",`${this.isRecours?"Recours":"Ticket"} annul\xE9`);break}this.fichiersJustificatifs.length>0&&this.uploadFichiersJustificatifs(),this.annulerDecision()}ajouterCommentaireDecision(t,e){if(!this.item)return;let s={id:this.item.commentaires.length+1,auteur:`${this.currentUser?.nom} ${this.currentUser?.prenom}`||"Superviseur",contenu:`${t}

${e}`,date:new Date,type:"DECISION"};this.item.commentaires.push(s)}onFileSelect(t){let e=t.target.files;if(e)for(let s=0;s<e.length;s++){let r=e[s];if(r.size>5*1024*1024){this.toastService.error("Fichier trop volumineux",`${r.name} d\xE9passe 5MB`);continue}if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png"].includes(r.type)){this.toastService.error("Format non support\xE9",`${r.name} n'est pas dans un format accept\xE9`);continue}this.fichiersJustificatifs.push(r)}}retirerFichier(t){this.fichiersJustificatifs.splice(t,1)}formatFileSize(t){if(t===0)return"0 Bytes";let e=1024,s=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,r)).toFixed(2))+" "+s[r]}uploadFichiersJustificatifs(){this.fichiersJustificatifs.forEach(t=>{this.item&&this.item.fichiers.push({nom:`justificatif_${t.name}`,url:`/files/justificatifs/${t.name}`,type:"justificatif",uploadePar:this.currentUser?.email,dateUpload:new Date})}),this.toastService.success("Fichiers ajout\xE9s",`${this.fichiersJustificatifs.length} fichier(s) justificatif(s) ajout\xE9(s)`)}getDecisionTitle(){switch(this.decisionSuperviseur){case"VALIDER":return`Validation du ${this.isRecours?"recours":"ticket"}`;case"REJETER":return`Rejet du ${this.isRecours?"recours":"ticket"}`;case"COMPLEMENT":return"Demande de compl\xE9ment d'information";case"ANNULER":return`Annulation du ${this.isRecours?"recours":"ticket"}`;default:return"D\xE9cision"}}static \u0275fac=function(e){return new(e||o)(R(F),R(P),R(ee),R(te),R(z),R(B),R(q))};static \u0275cmp=A({type:o,selectors:[["app-traitement"]],decls:1,vars:1,consts:[["class","traitement-container",4,"ngIf"],[1,"traitement-container"],[1,"mb-4"],[1,"text-primary-600","hover:text-primary-700","flex","items-center",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"mb-8"],[1,"flex","justify-between","items-start"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-gray-600","mt-2"],["class","mt-3",4,"ngIf"],[1,"flex","space-x-3"],[1,"btn","btn-secondary",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-8"],[1,"lg:col-span-2","space-y-6"],[1,"card","p-6"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"form-label"],[1,"form-input",3,"ngModelChange","change","ngModel","disabled"],["value","NOUVEAU"],["value","EN_COURS"],["value","EN_ATTENTE_VALIDATION"],["value","VALIDE"],["value","REJETE"],["value","RESOLU"],["value","ANNULE"],["value","FERME"],[1,"form-input",3,"ngModelChange","ngModel"],["value","BASSE"],["value","NORMALE"],["value","HAUTE"],["value","CRITIQUE"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","datetime-local",1,"form-input",3,"ngModelChange","ngModel"],["class","mt-4",4,"ngIf"],["class","card p-6",4,"ngIf"],[1,"space-y-4"],["class","border rounded-lg p-4",3,"ngClass",4,"ngFor","ngForOf"],[1,"flex","space-x-2","mb-2"],[1,"btn","btn-sm",3,"click","ngClass"],["placeholder","Ajouter un commentaire...","rows","3",1,"form-input","mb-2",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click","disabled"],["class","border-l-4 pl-4",3,"ngClass",4,"ngFor","ngForOf"],[1,"space-y-6"],[1,"card","p-4"],[1,"font-medium","text-gray-900","mb-3"],[1,"space-y-2","text-sm"],[1,"flex","justify-between"],[1,"text-gray-600"],["class","flex justify-between",4,"ngIf"],[1,"space-y-2"],["class","flex items-center justify-between p-2 bg-gray-50 rounded",4,"ngFor","ngForOf"],[1,"btn","btn-warning","w-full",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 11l5-5m0 0l5 5m-5-5v12"],[1,"btn","btn-secondary","w-full",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"],[1,"btn","btn-gray","w-full",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"btn","btn-danger","w-full",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"fixed","bottom-6","right-6"],[1,"btn","btn-primary","btn-lg","shadow-lg",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"mt-3"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"mt-2","flex","flex-wrap","gap-2"],["class","inline-flex items-center px-2 py-1 rounded text-xs bg-green-100 text-green-800",4,"ngIf"],["class","inline-flex items-center px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",4,"ngIf"],["class","inline-flex items-center px-2 py-1 rounded text-xs bg-purple-100 text-purple-800",4,"ngIf"],["class","inline-flex items-center px-2 py-1 rounded text-xs bg-red-100 text-red-800",4,"ngIf"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","bg-green-100","text-green-800"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3","h-3","mr-1"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","bg-blue-100","text-blue-800"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","bg-purple-100","text-purple-800"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","bg-red-100","text-red-800"],[3,"value"],[1,"mt-4"],["type","number","min","0",1,"form-input",3,"ngModelChange","ngModel"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-lg","font-semibold","text-gray-900"],[1,"px-2","py-1","text-xs","rounded-full","bg-blue-100","text-blue-800"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-3","mb-6"],[1,"btn","btn-success","flex","items-center","justify-center",3,"click"],[1,"btn","btn-danger","flex","items-center","justify-center",3,"click"],[1,"btn","btn-warning","flex","items-center","justify-center",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"btn","btn-gray","flex","items-center","justify-center",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364L18.364 5.636"],["class","border rounded-lg p-4 bg-gray-50",4,"ngIf"],[1,"border","rounded-lg","p-4","bg-gray-50"],["class","space-y-4",4,"ngIf"],[1,"mt-4","pt-4","border-t"],[1,"mt-2"],["type","file","multiple","","accept",".pdf,.doc,.docx,.jpg,.png",1,"form-input",3,"change"],[1,"text-sm","text-gray-500","mt-1"],["placeholder","Ajouter un commentaire sur la validation...","rows","3",1,"form-input",3,"ngModelChange","ngModel"],[1,"btn","btn-success",3,"click"],[1,"text-red-500"],["placeholder","Expliquez clairement les raisons du rejet...","rows","4","required","",1,"form-input",3,"ngModelChange","ngModel"],[1,"btn","btn-danger",3,"click","disabled"],["placeholder","Pr\xE9cisez quels documents ou informations sont n\xE9cessaires...","rows","4","required","",1,"form-input",3,"ngModelChange","ngModel"],[1,"btn","btn-warning",3,"click","disabled"],["placeholder","Expliquez les raisons de l'annulation...","rows","4","required","",1,"form-input",3,"ngModelChange","ngModel"],[1,"btn","btn-gray",3,"click","disabled"],[1,"text-sm","font-medium","text-gray-700","mb-2"],["class","flex items-center justify-between p-2 bg-white rounded border",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-2","bg-white","rounded","border"],[1,"flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-gray-400","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"text-sm"],[1,"text-red-500","hover:text-red-700","text-sm",3,"click"],[1,"border","rounded-lg","p-4",3,"ngClass"],[1,"flex","justify-between","items-start","mb-2"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","mr-3",3,"ngClass"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2"],[1,"font-medium"],[1,"text-sm","text-gray-600"],[1,"px-2","py-1","text-xs","rounded-full",3,"ngClass"],[1,"ml-11","mt-3"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","text-sm"],[4,"ngIf"],[1,"flex","space-x-2"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["class","btn btn-sm btn-success",3,"click",4,"ngIf"],["class","btn btn-sm btn-warning",3,"click",4,"ngIf"],["class","mt-2 text-sm text-gray-500",4,"ngIf"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"btn","btn-sm","btn-success",3,"click"],[1,"btn","btn-sm","btn-warning",3,"click"],[1,"mt-2","text-sm","text-gray-500"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","inline","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],["class","border rounded-lg p-4 mb-4",4,"ngIf"],["class","border rounded-lg p-4",4,"ngIf"],[1,"border","rounded-lg","p-4","mb-4"],[1,"flex","justify-between","items-start","mb-3"],["class","space-y-3",4,"ngIf"],["class","text-sm text-amber-600 bg-amber-50 p-3 rounded-md",4,"ngIf"],["class","text-sm",4,"ngIf"],[1,"space-y-3"],["placeholder","Commentaire de validation...","rows","3",1,"form-input",3,"ngModelChange","ngModel"],[1,"btn","btn-danger",3,"click"],[1,"text-sm","text-amber-600","bg-amber-50","p-3","rounded-md"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.314 18.5c-.77.833.192 2.5 1.732 2.5z"],[1,"border","rounded-lg","p-4"],["class","text-sm text-gray-500 bg-gray-50 p-3 rounded-md",4,"ngIf"],["placeholder","Commentaire de validation niveau 2...","rows","3",1,"form-input",3,"ngModelChange","ngModel"],[1,"text-sm","text-gray-500","bg-gray-50","p-3","rounded-md"],[1,"border-l-4","pl-4",3,"ngClass"],[1,"flex","justify-between","items-start","mb-1"],[1,"flex","items-center","space-x-2"],[1,"text-sm","text-gray-500"],[1,"text-gray-700"],[1,"flex","items-center","justify-between","p-2","bg-gray-50","rounded"],[1,"text-primary-600","hover:text-primary-900","text-sm",3,"click"]],template:function(e,s){e&1&&v(0,Be,146,28,"div",0),e&2&&m("ngIf",s.item)},dependencies:[O,M,D,U,Z,Q,K,W,H,$,G,Y,X,J,j,L],styles:[".btn-lg[_ngcontent-%COMP%]{padding:.75rem 1.5rem;font-size:1rem;line-height:1.5rem}"]})};export{ie as TraitementComponent};
